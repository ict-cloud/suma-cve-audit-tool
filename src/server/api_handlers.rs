use crate::persistence::rdbms;
use crate::suma::sumaclient;

pub async fn erratalisthandler(i_kind: String) -> Result<impl::warp::Reply, warp::Rejection> {
    match i_kind.as_str() {
        "affected"   => { Ok(warp::reply::json(&rdbms::get_secadvisories(rdbms::SecAdvisoryKind::Affected))) }
        "unaffected" => { Ok(warp::reply::json(&rdbms::get_secadvisories(rdbms::SecAdvisoryKind::Unaffected))) }
        _            => { Ok(warp::reply::json(&rdbms::get_errataext())) }
    }
}

pub async fn errata_details_handler(i_id: i32) -> Result<impl::warp::Reply, warp::Rejection> {
    Ok(warp::reply::json(&rdbms::get_errata(i_id)))
}

pub async fn updator_handler() -> Result<impl::warp::Reply, warp::Rejection> {
    match sumaclient::run_api() {
        Ok(_) => Ok("loaded"),
        Err(_) => Err(warp::reject()),
    }
}