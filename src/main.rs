extern crate pretty_env_logger;
extern crate log;

use tokio::runtime::Runtime;

mod server;
mod suma;
mod persistence;
#[cfg(test)]
mod tests;

fn main() {
    pretty_env_logger::init();
    // setup persistence layer rdbms
    match persistence::rdbms::setup() {
        Ok(_)       => log::info!("Successful setup"),
        Err(error)  => log::error!("Error setting up rdbms {}", error),
    };

    // run the api to load the records for inspection
    match suma::sumaclient::run_api() {
        Ok(_)    => log::info!("SUMA Client API successfully run"),
        Err(err) => log::error!("Error in SUMA Client API: {}", err)
    };
    
    let rt = Runtime::new().unwrap();

    println!("Starting webserver...");

    match rt.block_on(server::server::serv()) {
        Ok(_)  => log::info!("Done"),
        Err(e) => log::error!("An error ocurred: {}", e),
    };
}