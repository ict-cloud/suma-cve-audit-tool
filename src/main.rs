use log::*;
use tokio::runtime::Runtime;

mod server;
mod suma;
mod persistence;
#[cfg(test)]
mod tests;

fn main() {
    // setup persistence layer rdbms
    match persistence::rdbms::setup() {
        Ok(_)       => info!("Successful setup"),
        Err(error)  => error!("Error setting up rdbms {}", error),
    };

    // run the api to load the records for inspection
    match suma::sumaclient::run_api() {
        Ok(_)    => info!("SUMA Client API successfully run"),
        Err(err) => error!("Error in SUMA Client API: {}", err)
    };
    
    let rt = Runtime::new().unwrap();

    match rt.block_on(server::server::serv()) {
        Ok(_) => info!("Done"),
        Err(e) => error!("An error ocurred: {}", e),
    };
}
