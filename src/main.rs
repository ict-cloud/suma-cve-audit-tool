extern crate log;
extern crate pretty_env_logger;

use tokio::runtime::Runtime;

mod persistence;
mod server;
mod suma;
#[cfg(test)]
mod tests;

fn main() {
    pretty_env_logger::init();

    let rt = Runtime::new().unwrap();
    rt.block_on(persistence::rdbms_init::setup()).unwrap();

    // run the api to load the records for inspection
    match rt.block_on(suma::sumaclient::run_api()) {
        Ok(_) => log::info!("SUMA Client API successfully run"),
        Err(err) => log::error!("Error in SUMA Client API: {}", err),
    };

    println!("Webserver up and running");
    println!("Connect to http://127.0.0.1:8081");

    match rt.block_on(server::garcon::serv()) {
        Ok(_) => log::info!("Done"),
        Err(e) => log::error!("An error ocurred: {}", e),
    };
}
