use serde_derive::{Deserialize, Serialize};

mod audit_assessmnt;
mod audit_status;

pub use audit_assessmnt::*;
pub use audit_status::*;

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Errata {
    pub id: u32,
    pub date: String,
    pub update_date: String,
    pub advisory_synopsis: String,
    pub advisory_type: String,
    pub advisory_name: String,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ErrataExtended {
    pub id: u32,
    pub date: String,
    pub update_date: String,
    pub advisory_synopsis: String,
    pub advisory_type: String,
    pub advisory_name: String,
    pub cves: Vec<String>,
    pub sys_affected: bool,
}

impl Default for ErrataExtended {
    fn default() -> Self {
        let empty_string = String::from("");
        ErrataExtended {
            id: 0,
            date: empty_string.clone(),
            update_date:  empty_string.clone(),
            advisory_synopsis: empty_string.clone(),
            advisory_type: empty_string.clone(),
            advisory_name: empty_string.clone(),
            cves: vec![],
            sys_affected: false,
        }
    }
}

impl From<Errata> for ErrataExtended {
    fn from(errata: Errata) -> Self {
        ErrataExtended {
            id: errata.id,
            date: errata.date,
            update_date: errata.update_date,
            advisory_synopsis: errata.advisory_synopsis,
            advisory_type: errata.advisory_type,
            advisory_name: errata.advisory_name,
            cves: Vec::new(),
            sys_affected: false,
        }
    }
}

pub struct ErrataWithAudit {
    pub id: u32,
    pub date: String,
    pub advisory_name: String,
    pub advisory_synopsis: String,
    pub cves: Vec<String>,
    pub audit_data: ErrataAuditData,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct CVE {
    pub cve_id: String,
    pub suse_errata_list: Vec<Errata>,
}

// Method implementation
impl CVE {
    pub fn add_errata(&mut self, e: &Errata) {
        self.suse_errata_list.push(e.to_owned());
    }
}

// Audit structures
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub struct ErrataAuditData {
    pub id: u32,
    pub errata_id: u32,
    pub audit_date: String,
    pub auditor: String,
    pub resp: String,
    pub status: audit_status::AuditStatus,
    pub assessment_verdict: audit_assessmnt::AuditAssessment,
    pub assessed_score: f32,
    pub assessment_comment: String,
}

impl Default for ErrataAuditData {
    fn default() -> Self {
        ErrataAuditData{
            id: 0,
            errata_id: 0,
            audit_date: String::from(""),
            auditor: String::from(""),
            resp: String::from(""),
            status: audit_status::AuditStatus::New,
            assessment_verdict: audit_assessmnt::AuditAssessment::Unclear,
            assessed_score: 0.0,
            assessment_comment: String::from("")
        }
    }
}